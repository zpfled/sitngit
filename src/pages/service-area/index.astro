---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Section from "../../components/Section.astro";
import CountyTownList from "../../components/CountyTownList.astro";
import ServiceAreaMap from "../../components/ServiceAreaMap.astro";
import CTABlock from "../../components/CTABlock.astro";
import FAQList from "../../components/FAQList.astro";
import GoogleReviews from "../../components/GoogleReviews.astro";
import QuoteSection from "../../components/QuoteSection.astro";
import site from "../../content/site.json";
import googleReviews from "../../content/google-reviews.json";

const { pages, service_area, business, navigation } = site;
const countyNames = service_area.counties.map((county) => county.name);
const countyList =
  countyNames.length > 1
    ? `${countyNames.slice(0, -1).join(", ")} and ${countyNames[countyNames.length - 1]}`
    : countyNames[0] ?? "";
const heroSecondParagraph = `Counties served include ${countyList}. ${service_area.radius_statement}`;
const heroParagraphs =
  service_area.hero_paragraphs && service_area.hero_paragraphs.length
    ? service_area.hero_paragraphs
    : [service_area.description_short, heroSecondParagraph].filter(Boolean);
const townList = service_area.counties.flatMap((county) =>
  county.towns.map((town) => ({
    name: town.name,
    slug: town.slug
  }))
);
---
<BaseLayout title={pages.service_area.meta_title} description={pages.service_area.meta_description}>
  <section class="py-12 sm:py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h1 class="mt-4 text-3xl sm:text-4xl font-display text-ink">{pages.service_area.title}</h1>
      <div class="mt-4 space-y-4 text-ink/75">
        {heroParagraphs.map((paragraph) => (
          <p>{paragraph}</p>
        ))}
      </div>
      <div class="mt-6 flex flex-wrap gap-3">
        <a
          href={navigation.cta_primary.href}
          class="inline-flex items-center justify-center px-5 py-3 rounded-full bg-ink text-fog text-sm font-semibold shadow-soft hover:bg-ink/90"
        >
          {navigation.cta_primary.label}
        </a>
        <a
          href={navigation.cta_secondary.href}
          class="inline-flex items-center justify-center px-5 py-3 rounded-full border border-ink/20 text-ink text-sm font-semibold hover:bg-ink/5"
        >
          {`Call/Text ${business.phone_display}`}
        </a>
      </div>
    </div>
  </section>

  <section class="py-12 sm:py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-2xl sm:text-3xl font-display text-center">{pages.service_area.map_title}</h2>
      <p class="mt-4 max-w-2xl">{pages.service_area.map_body}</p>
      <div class="mt-8 grid gap-8 lg:grid-cols-[1.35fr_0.95fr] items-start">
        <div class="bg-fog border border-clay/70 rounded-2xl overflow-hidden shadow-soft">
          <ServiceAreaMap fullBleed />
        </div>
        <div class="space-y-6">
          <ul class="grid grid-cols-1 sm:grid-cols-2 gap-x-10 gap-y-4 text-ink/80">
            {townList.map((town) => (
              <li class="flex items-start gap-3">
                <span class="mt-1 text-ink/70">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 2c-3.31 0-6 2.69-6 6 0 4.25 6 12 6 12s6-7.75 6-12c0-3.31-2.69-6-6-6zm0 8.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 5.5 12 5.5s2.5 1.12 2.5 2.5S13.38 10.5 12 10.5z" />
                  </svg>
                </span>
                <a href={`/service-area/${town.slug}`} class="hover:text-ink">{town.name}</a>
              </li>
            ))}
            {service_area.town_list_note && (
              <li class="flex items-start gap-3">
                <span class="mt-1 text-ink/70">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 2c-3.31 0-6 2.69-6 6 0 4.25 6 12 6 12s6-7.75 6-12c0-3.31-2.69-6-6-6zm0 8.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 5.5 12 5.5s2.5 1.12 2.5 2.5S13.38 10.5 12 10.5z" />
                  </svg>
                </span>
                <span>{service_area.town_list_note}</span>
              </li>
            )}
          </ul>
        </div>
      </div>
    </div>
  </section>

  <section class="py-6 sm:py-10">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 text-ink/75">
      <p>{pages.service_area.flexibility}</p>
    </div>
  </section>

  <GoogleReviews
    title={pages.home.google_reviews.title}
    summary={googleReviews.summary}
    reviews={googleReviews.reviews}
  />

  <Section title={pages.service_area.faq_title}>
    <FAQList items={pages.service_area.faqs} />
  </Section>

  <QuoteSection />
</BaseLayout>
